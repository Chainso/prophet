{
  "ir_version": "0.1",
  "toolchain_version": "0.17.3",
  "ontology_source_file": "ontology/local/main.prophet",
  "ontology": {
    "id": "ont_commerce_local",
    "name": "commerce_local",
    "version": "1.0.0",
    "description": "Commerce ontology for order creation, approval, and shipping."
  },
  "types": [
    {
      "id": "type_money",
      "name": "Money",
      "kind": "custom",
      "base": "decimal",
      "constraints": {
        "min": "0.00"
      }
    }
  ],
  "objects": [
    {
      "id": "obj_order",
      "name": "Order",
      "fields": [
        {
          "id": "fld_order_order_id",
          "name": "order_id",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          },
          "key": "primary",
          "description": "Stable order identifier."
        },
        {
          "id": "fld_order_customer",
          "name": "customer",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_user"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_order_total_amount",
          "name": "total_amount",
          "type": {
            "kind": "custom",
            "target_type_id": "type_money"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_order_discount_code",
          "name": "discount_code",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        },
        {
          "id": "fld_order_tags",
          "name": "tags",
          "type": {
            "kind": "list",
            "element": {
              "kind": "base",
              "name": "string"
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        },
        {
          "id": "fld_order_shipping_address",
          "name": "shipping_address",
          "type": {
            "kind": "struct",
            "target_struct_id": "struct_address"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        }
      ],
      "keys": {
        "primary": {
          "field_ids": [
            "fld_order_order_id"
          ]
        },
        "display": {
          "field_ids": []
        }
      },
      "states": [
        {
          "id": "state_order_created",
          "name": "created",
          "initial": true
        },
        {
          "id": "state_order_approved",
          "name": "approved",
          "initial": false
        },
        {
          "id": "state_order_shipped",
          "name": "shipped",
          "initial": false
        }
      ],
      "transitions": [
        {
          "id": "trans_order_approve",
          "name": "approve",
          "from_state_id": "state_order_created",
          "to_state_id": "state_order_approved"
        },
        {
          "id": "trans_order_ship",
          "name": "ship",
          "from_state_id": "state_order_approved",
          "to_state_id": "state_order_shipped"
        }
      ],
      "description": "Customer order aggregate."
    },
    {
      "id": "obj_user",
      "name": "User",
      "fields": [
        {
          "id": "fld_user_user_id",
          "name": "user_id",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          },
          "key": "primary",
          "description": "Stable user identifier."
        },
        {
          "id": "fld_user_email",
          "name": "email",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        }
      ],
      "keys": {
        "primary": {
          "field_ids": [
            "fld_user_user_id"
          ]
        },
        "display": {
          "field_ids": []
        }
      },
      "states": [],
      "transitions": [],
      "description": "Platform user who can place or approve orders."
    }
  ],
  "structs": [
    {
      "id": "struct_address",
      "name": "Address",
      "fields": [
        {
          "id": "fld_struct_address_line1",
          "name": "line1",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_struct_address_city",
          "name": "city",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_struct_address_country_code",
          "name": "countryCode",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        }
      ]
    },
    {
      "id": "struct_approval_context",
      "name": "ApprovalContext",
      "fields": [
        {
          "id": "fld_struct_approval_context_approver",
          "name": "approver",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_user"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_struct_approval_context_watchers",
          "name": "watchers",
          "type": {
            "kind": "list",
            "element": {
              "kind": "object_ref",
              "target_object_id": "obj_user"
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        },
        {
          "id": "fld_struct_approval_context_reason",
          "name": "reason",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        }
      ]
    }
  ],
  "action_inputs": [
    {
      "id": "ain_approve_order",
      "name": "ApproveOrderCommand",
      "fields": [
        {
          "id": "fld_ain_approve_order_order",
          "name": "order",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_order"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_ain_approve_order_approved_by",
          "name": "approvedBy",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_user"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        },
        {
          "id": "fld_ain_approve_order_notes",
          "name": "notes",
          "type": {
            "kind": "list",
            "element": {
              "kind": "base",
              "name": "string"
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        },
        {
          "id": "fld_ain_approve_order_context",
          "name": "context",
          "type": {
            "kind": "struct",
            "target_struct_id": "struct_approval_context"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        }
      ],
      "description": "Input payload for approving an order."
    },
    {
      "id": "ain_create_order",
      "name": "CreateOrderCommand",
      "fields": [
        {
          "id": "fld_ain_create_order_customer",
          "name": "customer",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_user"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_ain_create_order_total_amount",
          "name": "totalAmount",
          "type": {
            "kind": "custom",
            "target_type_id": "type_money"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_ain_create_order_discount_code",
          "name": "discountCode",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        },
        {
          "id": "fld_ain_create_order_tags",
          "name": "tags",
          "type": {
            "kind": "list",
            "element": {
              "kind": "base",
              "name": "string"
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        },
        {
          "id": "fld_ain_create_order_shipping_address",
          "name": "shippingAddress",
          "type": {
            "kind": "struct",
            "target_struct_id": "struct_address"
          },
          "cardinality": {
            "min": 0,
            "max": 1
          }
        }
      ]
    },
    {
      "id": "ain_ship_order",
      "name": "ShipOrderCommand",
      "fields": [
        {
          "id": "fld_ain_ship_order_order",
          "name": "order",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_order"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_ain_ship_order_carrier",
          "name": "carrier",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_ain_ship_order_tracking_number",
          "name": "trackingNumber",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_ain_ship_order_package_ids",
          "name": "packageIds",
          "type": {
            "kind": "list",
            "element": {
              "kind": "base",
              "name": "string"
            }
          },
          "cardinality": {
            "min": 1,
            "max": "many"
          }
        }
      ]
    }
  ],
  "action_outputs": [
    {
      "id": "aout_approve_order",
      "name": "ApproveOrderResult",
      "fields": [
        {
          "id": "fld_aout_approve_order_order",
          "name": "order",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_order"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_aout_approve_order_decision",
          "name": "decision",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_aout_approve_order_warnings",
          "name": "warnings",
          "type": {
            "kind": "list",
            "element": {
              "kind": "base",
              "name": "string"
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        }
      ],
      "description": "Approval result contract."
    },
    {
      "id": "aout_create_order",
      "name": "CreateOrderResult",
      "fields": [
        {
          "id": "fld_aout_create_order_order",
          "name": "order",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_order"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_aout_create_order_current_state",
          "name": "currentState",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        }
      ]
    },
    {
      "id": "aout_ship_order",
      "name": "ShipOrderResult",
      "fields": [
        {
          "id": "fld_aout_ship_order_order",
          "name": "order",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_order"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_aout_ship_order_status",
          "name": "shipmentStatus",
          "type": {
            "kind": "base",
            "name": "string"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        },
        {
          "id": "fld_aout_ship_order_labels",
          "name": "labels",
          "type": {
            "kind": "list",
            "element": {
              "kind": "base",
              "name": "string"
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        },
        {
          "id": "fld_aout_ship_order_label_batches",
          "name": "labelBatches",
          "type": {
            "kind": "list",
            "element": {
              "kind": "list",
              "element": {
                "kind": "base",
                "name": "string"
              }
            }
          },
          "cardinality": {
            "min": 0,
            "max": "many"
          }
        }
      ]
    }
  ],
  "actions": [
    {
      "id": "act_approve_order",
      "name": "approveOrder",
      "kind": "process",
      "input_shape_id": "ain_approve_order",
      "output_shape_id": "aout_approve_order",
      "description": "Approves an existing order."
    },
    {
      "id": "act_create_order",
      "name": "createOrder",
      "kind": "process",
      "input_shape_id": "ain_create_order",
      "output_shape_id": "aout_create_order",
      "description": "Creates a new order."
    },
    {
      "id": "act_ship_order",
      "name": "shipOrder",
      "kind": "workflow",
      "input_shape_id": "ain_ship_order",
      "output_shape_id": "aout_ship_order",
      "description": "Ships an approved order."
    }
  ],
  "events": [
    {
      "id": "sig_payment_captured",
      "name": "PaymentCaptured",
      "kind": "signal",
      "fields": [
        {
          "id": "fld_sig_payment_captured_order",
          "name": "order",
          "type": {
            "kind": "object_ref",
            "target_object_id": "obj_order"
          },
          "cardinality": {
            "min": 1,
            "max": 1
          }
        }
      ]
    },
    {
      "id": "aout_approve_order",
      "name": "ApproveOrderResult",
      "kind": "action_output",
      "output_shape_id": "aout_approve_order",
      "description": "Approval result contract."
    },
    {
      "id": "aout_create_order",
      "name": "CreateOrderResult",
      "kind": "action_output",
      "output_shape_id": "aout_create_order"
    },
    {
      "id": "aout_ship_order",
      "name": "ShipOrderResult",
      "kind": "action_output",
      "output_shape_id": "aout_ship_order"
    },
    {
      "id": "trans_order_approve",
      "name": "OrderApproveTransition",
      "kind": "transition",
      "object_id": "obj_order",
      "transition_id": "trans_order_approve",
      "from_state_id": "state_order_created",
      "to_state_id": "state_order_approved"
    },
    {
      "id": "trans_order_ship",
      "name": "OrderShipTransition",
      "kind": "transition",
      "object_id": "obj_order",
      "transition_id": "trans_order_ship",
      "from_state_id": "state_order_approved",
      "to_state_id": "state_order_shipped"
    }
  ],
  "triggers": [
    {
      "id": "trg_on_order_approved",
      "name": "onOrderApproved",
      "event_id": "aout_approve_order",
      "action_id": "act_ship_order"
    },
    {
      "id": "trg_on_payment_captured",
      "name": "onPaymentCaptured",
      "event_id": "sig_payment_captured",
      "action_id": "act_approve_order"
    }
  ],
  "query_contracts": [
    {
      "object_id": "obj_order",
      "object_name": "Order",
      "paths": {
        "list": "/orders",
        "get_by_id": "/orders/{id}",
        "typed_query": "/orders/query"
      },
      "pageable": {
        "supported": true,
        "default_size": 20
      },
      "filters": [
        {
          "field_id": "fld_order_customer",
          "field_name": "customer",
          "operators": [
            "eq",
            "in"
          ]
        },
        {
          "field_id": "fld_order_discount_code",
          "field_name": "discount_code",
          "operators": [
            "eq",
            "in",
            "contains"
          ]
        },
        {
          "field_id": "fld_order_order_id",
          "field_name": "order_id",
          "operators": [
            "eq",
            "in",
            "contains"
          ]
        },
        {
          "field_id": "fld_order_total_amount",
          "field_name": "total_amount",
          "operators": [
            "eq",
            "in",
            "gte",
            "lte"
          ]
        },
        {
          "field_id": "__current_state__",
          "field_name": "currentState",
          "operators": [
            "eq",
            "in"
          ]
        }
      ],
      "contract_hash": "2c941ff0fc0a80d288af67daa87728330c996d5ed1d09ad4f8c45bdd4917ff74"
    },
    {
      "object_id": "obj_user",
      "object_name": "User",
      "paths": {
        "list": "/users",
        "get_by_id": "/users/{id}",
        "typed_query": "/users/query"
      },
      "pageable": {
        "supported": true,
        "default_size": 20
      },
      "filters": [
        {
          "field_id": "fld_user_email",
          "field_name": "email",
          "operators": [
            "eq",
            "in",
            "contains"
          ]
        },
        {
          "field_id": "fld_user_user_id",
          "field_name": "user_id",
          "operators": [
            "eq",
            "in",
            "contains"
          ]
        }
      ],
      "contract_hash": "94a173901b491822695755ca0a0ee03b8a8fb1d259dfce6a0b7d5f4eb6dbfd1c"
    }
  ],
  "generation_profile": {
    "golden_stack": "spring_boot"
  },
  "compatibility_profile": {
    "strict_enums": false,
    "list_scalar_shape_changes_are_breaking": true,
    "nested_list_shape_changes_are_breaking": true,
    "struct_field_contract_changes_are_breaking": true,
    "custom_type_constraint_changes_are_breaking": true
  },
  "query_contracts_version": "c813af06b02746404be863b73c3bb60dd5711f0a7ec0844abe7f68056a0c28d5",
  "ir_hash": "fb727d8cbda2878f1a0c25a6573b0bfbcec31ec3d2c398c0dd83cb46dae67ecf"
}
