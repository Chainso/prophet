// Code generated by prophet-cli. DO NOT EDIT.

import type { Application } from 'express';
import { buildActionRouter } from './action-routes.js';
import { buildQueryRouter } from './query-routes.js';
import { ActionExecutionService } from './action-service.js';
import { EventEmitterNoOp, type EventEmitter } from './events.js';
import type { ActionContext, ActionHandlers } from './action-handlers.js';
import type { Repositories } from './persistence.js';

export interface MountDependencies {
  repositories: Repositories;
  handlers: ActionHandlers;
  eventEmitter?: EventEmitter;
}

export function mountProphet(app: Application, deps: MountDependencies): void {
  const eventEmitter = deps.eventEmitter ?? new EventEmitterNoOp();
  const context: ActionContext = {
    repositories: deps.repositories,
    eventEmitter,
  };
  const service = new ActionExecutionService(deps.handlers, eventEmitter);
  app.use(buildActionRouter(service, context));
  app.use(buildQueryRouter(deps.repositories));
}
