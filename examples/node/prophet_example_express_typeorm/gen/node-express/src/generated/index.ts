// Code generated by prophet-cli. DO NOT EDIT.

import type { Application } from 'express';
import { buildActionRouter } from './action-routes.js';
import { buildQueryRouter } from './query-routes.js';
import { ActionExecutionService } from './action-service.js';
import { NoOpEventPublisher, type EventPublisher } from './events.js';
import type { ActionContext, ActionHandlers } from './action-handlers.js';
import type { Repositories } from './persistence.js';
import type { TransitionHandlers, TransitionValidators } from './transitions.js';

export interface MountDependencies {
  repositories: Repositories;
  handlers: ActionHandlers;
  transitionHandlers?: TransitionHandlers;
  transitionValidators?: TransitionValidators;
  eventPublisher?: EventPublisher;
  eventSource?: string;
  eventAttributes?: Record<string, string>;
}

export function mountProphet(app: Application, deps: MountDependencies): void {
  const eventPublisher = deps.eventPublisher ?? new NoOpEventPublisher();
  const context: ActionContext = {
    repositories: deps.repositories,
    eventPublisher,
    eventSource: deps.eventSource ?? 'commerce_local',
    eventAttributes: deps.eventAttributes,
  };
  const service = new ActionExecutionService(deps.handlers, eventPublisher);
  app.use(buildActionRouter(service, context));
  app.use(buildQueryRouter(deps.repositories));
}

export { TransitionServices } from './transitions.js';
export type { TransitionHandlers, TransitionValidators } from './transitions.js';
